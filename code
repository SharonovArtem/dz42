using System;
using System.Text.RegularExpressions;

namespace dzkurs
{
    internal class Program
    {
        static void Main(string[] args)
        {
            Market market = new Market();
            Seller seller = new Seller(0, null);
            Player player = new Player(500, null);
            bool isWorking = true;
            ConsoleKeyInfo key;

            seller.AddProduct("Пила", 15);
            seller.AddProduct("Карандаш", 2);
            seller.AddProduct("Отвёртка", 10);
            seller.AddProduct("Моторная лодка", 200);
            seller.AddProduct("Ручка", 3);
            seller.AddProduct("Лобзик", 12);

            Console.WriteLine("Добро пожаловать в магазин! Чего изволите?");

            while (isWorking)
            {
                Console.Write("Что у вас есть? - Q\n");
                Console.Write("Хочу сделать покупку - W\n");
                Console.Write("На вашем счету ");
                player.ShowMoney();
                Console.Write(" денег\n");

                key = Console.ReadKey(true);

                if (key.Key == ConsoleKey.Q)
                {
                    seller.ShowProducts();
                }
                else if (key.Key == ConsoleKey.W)
                {
                    market.GetProduct(player, seller);
                }
                else if (key.Key == ConsoleKey.Escape)
                {
                    Console.WriteLine("До свидания!");
                    isWorking = false;
                }
                else
                {
                    Console.WriteLine("Что-то я вас не понимаю");
                }

                Console.WriteLine("Что-нибудь ещё?");
            }
        }
    }

    class Player : MarketParticipant
    {
        public Player(int money, List<Product> products) : base(money, products)
        { }

        public void ShowMoney()
        {
            Console.Write(Money);
        }

        public bool TryGetMoney(out Product product)
        {
            product = null;
            bool isEnough = false;

            if (product.Price <= Money)
            {
                isEnough = true;
            }
            else
            {
                isEnough = false;
                Console.WriteLine("Иди работай!");
            }

            return isEnough;
        }

        public void GetProductFromMarket(Product gottenProduct)
        {
            Products.Add(gottenProduct);
        }

        public void ShowInventory()
        {
            for (int i = 0; i < Products.Count; i++)
            {
                Console.WriteLine(Products[i]);
            }
        }
    }

    class Seller : MarketParticipant
    {

        public Seller(int money, List<Product> products) : base(money, products)
        {

        }

        public void GetMoney(int moneyFromSell)
        {
            Money += moneyFromSell;

            Console.WriteLine("Деньги продавца - " + Money);
        }

        public void ShowMoney()
        {
            Console.Write(Money);
        }


        public bool TryGetProduct(out Product product)
        {
            product = new Product(null, 0);
            bool isGotten = false;

            Console.WriteLine("Введите название продукта");

            String userInput = Console.ReadLine();

            for (int i = 0; i < Products.Count; i++)
            {
                if (Products[i].Name == userInput)
                {
                    product = Products[i];

                    isGotten = true;
                    break;
                }
            }

            return isGotten;
        }

        public Product GiveProduct()
        {
            Product givenProduct = null;
            if(TryGetProduct(out Product product) == true)
            {
                givenProduct = product;
            }

            return givenProduct;
        }

        public List<Product> AddProduct(string name, int price)
        {
            Product product = new Product(name, price);
            Products.Add(product);

            return Products;
        }

        public void ShowProducts()
        {
            for (int i = 0; i < Products.Count; i++)
            {
                Console.WriteLine(Products[i].Name + " " + Products[i].Price);
            }
        }
    }

    class Product
    {
        public Product(string name, int price)
        {
            Name = name;
            Price = price;
        }

        public string Name { get; private set; }
        public int Price { get; private set; }
    }

    class MarketParticipant
    {
        protected int Money;
        protected List<Product> Products = new List<Product>();

        public MarketParticipant(int money, List<Product> products)
        {
            products = Products;
            money = Money;
        }
    }

    class Market
    {
        public void GetProduct(Player player, Seller seller)
        {
            Product product = seller.GiveProduct();

            if (player.TryGetMoney(out product))
            {
                player.GetProductFromMarket(product);
            }

            Console.WriteLine("У вас есть: ");
            player.ShowInventory();
        }
    }
}
